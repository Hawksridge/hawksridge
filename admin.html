<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Admin | Matt Mihály</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #1a1a1a;
            --bg-light: #252525;
            --bg-lighter: #333;
            --text: #f0f0f0;
            --text-dim: #888;
            --accent: #4a9eff;
            --accent-hover: #6bb3ff;
            --danger: #ff4a4a;
            --success: #4aff7a;
            --border: #444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .header {
            background: var(--bg-light);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-success {
            background: var(--success);
            color: #1a1a1a;
        }

        .btn-success:hover {
            opacity: 0.9;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: var(--bg-lighter);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-dim);
            transition: all 0.2s ease;
        }

        .tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .tab:hover:not(.active) {
            background: var(--bg-lighter);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .photo-card {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            cursor: grab;
            transition: all 0.2s ease;
        }

        .photo-card:hover {
            border-color: var(--accent);
        }

        .photo-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .photo-card.drag-over {
            border-color: var(--success);
            transform: scale(1.02);
        }

        .photo-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: var(--bg-lighter);
        }

        .photo-info {
            padding: 1rem;
        }

        .photo-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .photo-location {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 0.75rem;
        }

        .photo-meta {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .photo-tag {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            background: var(--bg-lighter);
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .photo-tag.color {
            background: rgba(74, 158, 255, 0.2);
            color: var(--accent);
        }

        .photo-tag.bw {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-dim);
        }

        .photo-actions {
            display: flex;
            gap: 0.5rem;
        }

        .photo-actions .btn {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.8rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-light);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-dim);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-group select {
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .image-preview {
            width: 100%;
            height: 150px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-preview.empty {
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        /* Export Modal */
        .export-content {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            max-height: 400px;
            overflow: auto;
        }

        .export-content pre {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.75rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .copy-success {
            color: var(--success);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .copy-success.show {
            opacity: 1;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-dim);
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        /* Instructions */
        .instructions {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .instructions h3 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }

        .instructions ul {
            margin-left: 1.25rem;
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Gallery Admin</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openAddModal()">+ Add Photo</button>
            <button class="btn btn-success" onclick="openExportModal()">Export HTML</button>
        </div>
    </header>

    <div class="container">
        <div class="instructions">
            <h3>How to use this admin panel:</h3>
            <ul>
                <li><strong>Drag and drop</strong> photos to reorder them within each gallery</li>
                <li><strong>Add Photo</strong> to add new images with title and location</li>
                <li><strong>Edit</strong> to modify existing photo details</li>
                <li><strong>Delete</strong> to remove photos from the gallery</li>
                <li><strong>Export HTML</strong> to get the code - paste it into index.html to update your live site</li>
            </ul>
        </div>

        <div class="tabs">
            <button class="tab active" data-filter="color" onclick="switchTab('color')">Color Photos</button>
            <button class="tab" data-filter="bw" onclick="switchTab('bw')">B&W Photos</button>
        </div>

        <div class="gallery-grid" id="gallery">
            <!-- Photos will be rendered here -->
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal-overlay" id="photoModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Add Photo</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Upload Local Image</label>
                    <input type="file" id="photoFile" accept="image/*" onchange="handleFileSelect()" style="margin-bottom: 0.5rem;">
                    <p style="font-size: 0.75rem; color: var(--text-dim); margin-top: 0.25rem;">
                        After adding, copy your image file to the <strong>images/</strong> folder in your site
                    </p>
                </div>
                <div class="form-group">
                    <label>— OR enter Image URL —</label>
                    <input type="text" id="photoUrl" placeholder="https://example.com/image.jpg or images/myphoto.jpg" oninput="handleUrlInput()">
                    <div class="image-preview empty" id="imagePreview">
                        Image preview will appear here
                    </div>
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="photoTitle" placeholder="Dawn Over the Peaks">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="photoLocation" placeholder="Swiss Alps">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Type</label>
                        <select id="photoType">
                            <option value="color">Color</option>
                            <option value="bw">B&W</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dimension</label>
                        <select id="photoDimension">
                            <option value="landscape">Landscape (wide)</option>
                            <option value="portrait">Portrait (tall)</option>
                            <option value="square">Square</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" id="saveBtn" onclick="savePhoto()">Add Photo</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Export Gallery HTML</h2>
                <button class="modal-close" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--text-dim); font-size: 0.9rem;">
                    Copy this HTML and replace the gallery-grid div contents in index.html
                </p>
                <div class="export-content">
                    <pre id="exportCode"></pre>
                </div>
                <p class="copy-success" id="copySuccess">Copied to clipboard!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeExportModal()">Close</button>
                <button class="btn btn-primary" onclick="copyExport()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        // Photos array - will be loaded from index.html
        let photos = [];

        let currentFilter = 'bw';
        let editingId = null;
        let nextId = 1;
        let draggedItem = null;
        let localPreviewData = null;

        // Load gallery from index.html on startup
        async function loadGalleryFromIndex() {
            try {
                const response = await fetch('index.html');
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const galleryItems = doc.querySelectorAll('.gallery-item');
                photos = [];

                galleryItems.forEach((item, index) => {
                    const img = item.querySelector('img');
                    const titleEl = item.querySelector('.photo-title');
                    const locationEl = item.querySelector('.photo-location');

                    if (img && titleEl && locationEl) {
                        // Get dimension from class
                        let dimension = 'landscape';
                        if (item.classList.contains('portrait')) dimension = 'portrait';
                        else if (item.classList.contains('square')) dimension = 'square';

                        photos.push({
                            id: index + 1,
                            url: img.getAttribute('src'),
                            title: titleEl.textContent,
                            location: locationEl.textContent,
                            type: item.getAttribute('data-type') || 'color',
                            dimension: dimension
                        });
                    }
                });

                nextId = photos.length + 1;

                // Set initial tab based on what photos exist
                const hasColor = photos.some(p => p.type === 'color');
                const hasBW = photos.some(p => p.type === 'bw');
                currentFilter = hasColor ? 'color' : (hasBW ? 'bw' : 'color');

                // Update tab UI
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.filter === currentFilter);
                });

                renderGallery();
                console.log(`Loaded ${photos.length} photos from index.html`);
            } catch (error) {
                console.error('Error loading gallery from index.html:', error);
                renderGallery(); // Render empty gallery
            }
        }

        function saveToStorage() {
            localStorage.setItem('galleryPhotos', JSON.stringify(photos));
        }

        function switchTab(filter) {
            currentFilter = filter;
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });
            renderGallery();
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            const filtered = photos.filter(p => p.type === currentFilter);

            if (filtered.length === 0) {
                gallery.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <h3>No photos yet</h3>
                        <p>Add your first ${currentFilter === 'bw' ? 'black & white' : 'color'} photo</p>
                    </div>
                `;
                return;
            }

            gallery.innerHTML = filtered.map(photo => `
                <div class="photo-card" draggable="true" data-id="${photo.id}">
                    <img src="${photo.url}" alt="${photo.title}" class="photo-image" onerror="this.src='https://via.placeholder.com/400x300?text=Image+Not+Found'">
                    <div class="photo-info">
                        <div class="photo-title">${photo.title}</div>
                        <div class="photo-location">${photo.location}</div>
                        <div class="photo-meta">
                            <span class="photo-tag ${photo.type}">${photo.type === 'bw' ? 'B&W' : 'Color'}</span>
                            <span class="photo-tag">${photo.dimension}</span>
                        </div>
                        <div class="photo-actions">
                            <button class="btn btn-secondary" onclick="editPhoto(${photo.id})">Edit</button>
                            <button class="btn btn-danger" onclick="deletePhoto(${photo.id})">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // Add drag events
            document.querySelectorAll('.photo-card').forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('dragleave', handleDragLeave);
                card.addEventListener('drop', handleDrop);
            });
        }

        // Drag and drop handlers
        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.photo-card').forEach(card => {
                card.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            if (this !== draggedItem) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (this !== draggedItem) {
                const fromId = parseInt(draggedItem.dataset.id);
                const toId = parseInt(this.dataset.id);

                const fromIndex = photos.findIndex(p => p.id === fromId);
                const toIndex = photos.findIndex(p => p.id === toId);

                const [moved] = photos.splice(fromIndex, 1);
                photos.splice(toIndex, 0, moved);

                saveToStorage();
                renderGallery();
            }
        }

        function openAddModal() {
            editingId = null;
            localPreviewData = null;
            document.getElementById('modalTitle').textContent = 'Add Photo';
            document.getElementById('saveBtn').textContent = 'Add Photo';
            document.getElementById('photoFile').value = '';
            document.getElementById('photoUrl').value = '';
            document.getElementById('photoTitle').value = '';
            document.getElementById('photoLocation').value = '';
            document.getElementById('photoType').value = currentFilter;
            document.getElementById('photoDimension').value = 'landscape';
            updatePreview();
            document.getElementById('photoModal').classList.add('active');
        }

        function editPhoto(id) {
            const photo = photos.find(p => p.id === id);
            if (!photo) return;

            editingId = id;
            localPreviewData = null;
            document.getElementById('modalTitle').textContent = 'Edit Photo';
            document.getElementById('saveBtn').textContent = 'Save Changes';
            document.getElementById('photoFile').value = '';
            document.getElementById('photoUrl').value = photo.url;
            document.getElementById('photoTitle').value = photo.title;
            document.getElementById('photoLocation').value = photo.location;
            document.getElementById('photoType').value = photo.type;
            document.getElementById('photoDimension').value = photo.dimension;
            updatePreview();
            document.getElementById('photoModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('photoModal').classList.remove('active');
            editingId = null;
        }

        function handleFileSelect() {
            const fileInput = document.getElementById('photoFile');
            const file = fileInput.files[0];

            if (file) {
                const filename = file.name.replace(/\s+/g, '-').toLowerCase();

                // Create object URL for preview
                localPreviewData = URL.createObjectURL(file);
                const preview = document.getElementById('imagePreview');
                preview.innerHTML = `<img src="${localPreviewData}">`;
                preview.classList.remove('empty');

                // Set the URL path
                document.getElementById('photoUrl').value = 'images/' + filename;

                // Auto-fill title from filename if empty
                const titleInput = document.getElementById('photoTitle');
                if (!titleInput.value) {
                    const nameWithoutExt = file.name.replace(/\.[^/.]+$/, '').replace(/[-_]/g, ' ');
                    titleInput.value = nameWithoutExt.charAt(0).toUpperCase() + nameWithoutExt.slice(1);
                }
            }
        }

        function handleUrlInput() {
            // User is manually typing in URL field, clear local preview
            localPreviewData = null;
            document.getElementById('photoFile').value = '';
            updatePreview();
        }

        function updatePreview() {
            const url = document.getElementById('photoUrl').value;
            const preview = document.getElementById('imagePreview');

            // If we have a local preview from file upload, use that
            if (localPreviewData) {
                preview.innerHTML = `<img src="${localPreviewData}">`;
                preview.classList.remove('empty');
            } else if (url) {
                preview.innerHTML = `<img src="${url}" onerror="this.parentElement.innerHTML='Invalid image URL'; this.parentElement.classList.add('empty');">`;
                preview.classList.remove('empty');
            } else {
                preview.innerHTML = 'Image preview will appear here';
                preview.classList.add('empty');
            }
        }

        function savePhoto() {
            const url = document.getElementById('photoUrl').value.trim();
            const title = document.getElementById('photoTitle').value.trim();
            const location = document.getElementById('photoLocation').value.trim();
            const type = document.getElementById('photoType').value;
            const dimension = document.getElementById('photoDimension').value;

            if (!url || !title || !location) {
                alert('Please fill in all fields');
                return;
            }

            if (editingId) {
                const photo = photos.find(p => p.id === editingId);
                if (photo) {
                    photo.url = url;
                    photo.title = title;
                    photo.location = location;
                    photo.type = type;
                    photo.dimension = dimension;
                }
            } else {
                photos.push({
                    id: nextId++,
                    url,
                    title,
                    location,
                    type,
                    dimension
                });
            }

            saveToStorage();
            closeModal();
            switchTab(type);
        }

        function deletePhoto(id) {
            if (confirm('Are you sure you want to delete this photo?')) {
                photos = photos.filter(p => p.id !== id);
                saveToStorage();
                renderGallery();
            }
        }

        function openExportModal() {
            const html = generateExportHTML();
            document.getElementById('exportCode').textContent = html;
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
            document.getElementById('copySuccess').classList.remove('show');
        }

        function generateExportHTML() {
            const colorPhotos = photos.filter(p => p.type === 'color');
            const bwPhotos = photos.filter(p => p.type === 'bw');

            let html = '<!-- COLOR PHOTOS -->\n';
            colorPhotos.forEach(photo => {
                html += generatePhotoHTML(photo);
            });

            html += '\n<!-- B&W PHOTOS -->\n';
            bwPhotos.forEach(photo => {
                html += generatePhotoHTML(photo);
            });

            return html;
        }

        function generatePhotoHTML(photo) {
            return `<div class="gallery-item ${photo.dimension}" data-type="${photo.type}">
    <img src="${photo.url}" alt="${photo.title}" loading="lazy">
    <div class="gallery-overlay">
        <span class="photo-title">${photo.title}</span>
        <span class="photo-location">${photo.location}</span>
    </div>
</div>

`;
        }

        function copyExport() {
            const html = generateExportHTML();
            navigator.clipboard.writeText(html).then(() => {
                document.getElementById('copySuccess').classList.add('show');
                setTimeout(() => {
                    document.getElementById('copySuccess').classList.remove('show');
                }, 2000);
            });
        }

        // Close modals on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeExportModal();
            }
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeModal();
                    closeExportModal();
                }
            });
        });

        // Initial load from index.html
        loadGalleryFromIndex();
    </script>
</body>
</html>
